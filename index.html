<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smartphone Tycoon – Prototype</title>

  <style>
    :root{
      --bg:#0b0f18;
      --panel:#121827;
      --panel-soft:#0f1422;
      --interactive:#182036;
      --border:#232b45;
      --accent:#6c7cff;
      --danger:#ff5c7a;
      --text:#e6e9f2;
      --muted:#9aa3bd;

      /* NEW: accent clair pour indiquer "à remplir" */
      --action-bg: rgba(255,255,255,0.10);
      --action-bg-strong: rgba(255,255,255,0.14);
      --action-border: rgba(108,124,255,0.42);
      --action-border-strong: rgba(108,124,255,0.70);
    }

    body{
      margin:0;
      background: linear-gradient(180deg, #0b0f18 0%, #0e1424 100%);
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, system-ui, Segoe UI, Roboto, sans-serif;
    }

    /* ========= HEADER (PATCH #1: plus compact) ========= */
    header{
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 12px 12px 10px;
      border-bottom: 1px solid var(--border);
      background: rgba(15, 20, 34, 0.92);
      backdrop-filter: blur(10px);
    }

    .top-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .kpi{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .pill{
      background: rgba(18,24,39,0.9);
      border: 1px solid var(--border);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 11px;
      color: var(--text);
      display:inline-flex;
      align-items:baseline;
      gap:6px;
      line-height: 1.2;
    }

    .pill b{ font-weight: 800; }
    .pill.muted{ color: var(--muted); }
    .muted{ color: var(--muted); font-size: 12px; }

    /* PATCH #1: "Marché" rejoint le groupe KPI => plus de bloc isolé */
    #kpi-macro{
      margin-left: 0;
    }

    main{
      padding: 14px;
      padding-bottom: 110px;
      max-width: 920px;
      margin: 0 auto;
    }

    .card{
      background: rgba(18,24,39,0.88);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .card h3{
      margin: 0 0 12px;
      font-size: 15px;
      letter-spacing: 0.4px;
      color: var(--accent);
    }

    .row{
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
    }
    .row > *{ flex:1; min-width: 160px; }

    label{
      display:block;
      margin: 10px 0 6px;
      font-size: 12px;
      color: var(--muted);
    }

    input[type="number"], select{
      width:100%;
      box-sizing:border-box;
      background: var(--interactive);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 10px;
      font-size: 14px;
    }

    /* Select trop long : ellipsis */
    select{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ========= PATCH #2 : slider moins "énorme" ========= */
    input[type="range"]{
      width:100%;
      height: 26px; /* au lieu de 38 */
      background: transparent;
    }

    input:focus, select:focus{
      outline:none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(108,124,255,0.28);
    }

    /* Zones INFO vs INTERACTION */
    .info-block{
      background: rgba(15,20,34,0.9);
      border: 1px solid rgba(35,43,69,0.9);
      border-radius: 14px;
      padding: 12px;
      margin-top: 12px;
    }

    /* ========= INTERACTIVE : beaucoup plus clair (demande utilisateur) ========= */
    .interactive-block{
      background: rgba(27,36,64,0.80);
      border: 1px solid rgba(47,59,106,0.95);
      border-radius: 14px;
      padding: 12px;
      margin-top: 12px;
    }

    /* Fond et bordure plus visibles */
    .interactive-block select,
    .interactive-block input[type="number"],
    .interactive-block input[type="range"]{
      background: var(--action-bg);
      border-color: var(--action-border);
    }

    /* (plus net encore) : select & number plus “call-to-action” */
    .interactive-block select,
    .interactive-block input[type="number"]{
      background: var(--action-bg-strong);
      border-color: var(--action-border-strong);
    }

    /* Petite “lueur” permanente pour signaler l’interaction */
    .interactive-block select,
    .interactive-block input[type="number"]{
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }

    .interactive-block select:focus,
    .interactive-block input[type="number"]:focus{
      border-color: rgba(108,124,255,0.95);
      box-shadow: 0 0 0 2px rgba(108,124,255,0.28), inset 0 0 0 1px rgba(255,255,255,0.08);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(108,124,255,0.12);
      border: 1px solid rgba(108,124,255,0.30);
      color: var(--text);
      font-size: 12px;
      margin-top: 8px;
    }

    .badge b{ color: var(--accent); }

    /* ========= PATCH #4 : mini barre de progression (écosystème d'apps) ========= */
    .mini-bar{
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(108,124,255,0.35);
      background: rgba(255,255,255,0.06);
      overflow: hidden;
      margin-top: 8px;
    }
    .mini-bar > span{
      display:block;
      height:100%;
      width: 10%;
      background: rgba(108,124,255,0.75);
      border-radius: 999px;
    }

    pre{
      margin: 0;
      white-space: pre-wrap;
      word-break: break-word;
      background: rgba(15,20,34,0.95);
      border: 1px solid var(--border);
      padding: 12px;
      border-radius: 14px;
      color: var(--text);
      line-height: 1.35;
      font-size: 12px;
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    .actions button{
      flex:1;
      padding: 13px 14px;
      border-radius: 14px;
      border: 0;
      font-weight: 800;
      font-size: 14px;
    }

    .primary{
      background: linear-gradient(135deg, #6c7cff, #8f9bff);
      color: #0b0f18;
      box-shadow: 0 6px 18px rgba(108,124,255,0.35);
      transition: transform 0.08s ease;
    }
    .primary:active{ transform: scale(0.98); }

    .secondary{
      background: rgba(27,36,64,0.85);
      border: 1px solid rgba(47,59,106,0.9);
      color: var(--text);
    }

    .danger{
      background: var(--danger);
      color: #0b0f18;
      box-shadow: 0 6px 16px rgba(255,92,122,0.25);
    }

    nav{
      position: fixed;
      left:0;
      right:0;
      bottom:0;
      z-index: 30;
      padding: 12px;
      display:flex;
      gap: 8px;
      background: rgba(15,20,34,0.95);
      border-top: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    nav button{
      flex: 1;
      padding: 12px 10px;
      border-radius: 14px;
      background: rgba(18,24,39,0.85);
      border: 1px solid var(--border);
      color: var(--text);
      font-weight: 700;
    }

    nav button.active{
      border-color: rgba(108,124,255,0.65);
      background: rgba(27,36,64,0.85);
    }

    /* Tooltips */
    .has-tip{
      cursor: pointer;
      text-decoration: none;
      border-bottom: 1px dotted rgba(154,163,189,0.55);
      padding-bottom: 1px;
    }

    .tip-bubble{
      position: fixed;
      z-index: 9999;
      left: 12px;
      right: 12px;
      bottom: 92px;
      background: rgba(15,20,34,0.96);
      border: 1px solid rgba(108,124,255,0.35);
      border-radius: 14px;
      padding: 12px 12px;
      color: var(--text);
      font-size: 12px;
      line-height: 1.35;
      box-shadow: 0 14px 40px rgba(0,0,0,0.35);
    }

    .tip-bubble .tip-title{
      font-weight: 800;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .tip-bubble .tip-close{
      position: absolute;
      top: 8px;
      right: 10px;
      background: transparent;
      border: 0;
      color: var(--muted);
      font-size: 16px;
    }
  </style>
</head>

<body>
<header>
  <div class="top-row">
    <div class="kpi">
      <span class="pill" id="kpi-date">Année : 2000 / Trimestre : Q1</span>

      <span class="pill">
        <span class="has-tip" data-tip="Réputation de l’entreprise (0–100). Influence la confiance des clients, la tolérance aux défauts (SAV) et l’efficacité du marketing.">
          Réputation
        </span>
        <b id="kpi-brand">35</b><span class="muted">/100</span>
      </span>

      <span class="pill">
        <span class="has-tip" data-tip="Trésorerie disponible. Si tu passes sous 0, tu risques un emprunt automatique (plus tard : faillite possible).">
          Trésorerie
        </span>
        <b id="kpi-cash">$0</b>
      </span>

      <span class="pill">
        <span class="has-tip" data-tip="Valorisation de l’entreprise (bourse). Dépend des profits, de la réputation et du contexte de marché.">
          Valorisation
        </span>
        <b id="kpi-mcap">$0</b>
      </span>

      <span class="pill">
        <span class="has-tip" data-tip="Part de marché estimée ce trimestre. Monte si tu vends plus que tes concurrents, baisse sinon.">
          Parts de marché
        </span>
        <b id="kpi-share">0%</b>
      </span>

      <!-- PATCH #1 : Marché dans la même ligne KPI -->
      <span class="pill muted" id="kpi-macro">
        <span class="has-tip" data-tip="État du marché (conjoncture). Affecte surtout la valorisation et légèrement le volume global.">
          Marché
        </span>
        <span id="kpi-macro-value">Marché normal</span>
      </span>
    </div>
  </div>
</header>

<main>
  <section class="card" id="screen-product">
    <h3>Produit & OS</h3>

    <div class="interactive-block">
      <div class="row">
        <div>
          <label>Positionnement produit</label>
          <select id="product-tier">
            <option value="budget">Budget</option>
            <option value="mainstream" selected>Mainstream</option>
            <option value="premium">Premium</option>
          </select>
          <div class="muted">Le segment visé influence les attentes des clients.</div>

          <label>
            <span class="has-tip" data-tip="Qualité produit (0–100). Plus haut = produit plus désirable (attractivité), un peu moins de SAV, mais composants plus coûteux.">
              Qualité produit (0–100)
            </span>
          </label>
          <input type="range" id="perf" min="10" max="100" value="55" />
          <div class="muted">Score : <b id="perf-val">55</b></div>
        </div>

        <div>
          <label>
            <span class="has-tip" data-tip="Prix auquel tu vends ton téléphone. Plus haut = marge ↑ mais ventes ↓ (si trop cher pour le segment).">
              Prix de vente (USD)
            </span>
          </label>
          <input type="number" id="price" min="50" step="10" value="399" />
          <div class="muted">Plus haut = marge ↑, volume ↓</div>

          <label>
            <span class="has-tip" data-tip="Budget R&D dépensé ce trimestre. Accélère la progression de ton OS si tu en développes un, et améliore ta trajectoire tech.">
              Budget R&amp;D (USD)
            </span>
          </label>
          <input type="number" id="rnd" min="0" step="10000" value="30000" />
          <div class="muted">Investissement trimestriel (progressif).</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>
            <span class="has-tip" data-tip="OS sous licence : rapide mais royalties. OS propriétaire : plus long et coûteux, mais tu maîtrises ta stack (marges, dépendance).">
              Stratégie OS
            </span>
          </label>

          <!-- PATCH #3 : libellés courts (sans changer value) -->
          <select id="os-mode">
            <option value="license" selected>OS sous licence</option>
            <option value="closed">OS propriétaire fermé</option>
            <option value="open">OS propriétaire ouvert</option>
          </select>

          <div class="muted">
            <span class="has-tip" data-tip="Maturité de ton OS (0–100). Plus haut = plus stable, plus apprécié, meilleure efficacité long terme.">
              Maturité OS
            </span> :
            <b id="os-maturity">10</b>/100
          </div>
        </div>

        <div id="dev-row">
          <label>
            <span class="has-tip" data-tip="Écosystème d’apps (0–100). Important surtout pour un OS ouvert : plus haut = plus d’apps/partenaires, plus d’attrait long terme.">
              Écosystème d’apps
            </span>
          </label>

          <div class="muted" style="margin-top:2px;">
            <b id="dev-attract">10</b>/100
          </div>

          <!-- PATCH #4 : mini barre -->
          <div class="mini-bar" aria-label="Progression écosystème d'apps">
            <span id="dev-bar" style="width:10%"></span>
          </div>

          <div class="muted">Visible surtout si OS propriétaire (surtout ouvert).</div>
        </div>
      </div>
    </div>

    <div class="info-block">
      <div class="badge">
        <span class="has-tip" data-tip="Attractivité du modèle actuel (0–100). Résume la désirabilité : prix, qualité produit, réputation.">
          Attractivité produit
        </span> :
        <b id="prod-attract">0</b>/100
      </div>

      <div class="badge" style="margin-top:10px;">
        <span class="has-tip" data-tip="Indication (pas une vérité absolue) de l’intérêt du marché pour ton modèle ce trimestre.">
          Intérêt du marché (estim.)
        </span> :
        <b id="market-interest">—</b>
      </div>

      <div class="actions">
        <button class="secondary" id="btn-save">Sauver</button>
        <button class="danger" id="btn-reset">Reset run</button>
      </div>
    </div>
  </section>

  <section class="card" id="screen-production" style="display:none">
    <h3>Production</h3>

    <div class="interactive-block">
      <div class="row">
        <div>
          <label>
            <span class="has-tip" data-tip="Nombre maximum d’unités que tu peux assembler ce trimestre. Plus haut = plus de coûts fixes.">
              Capacité (unités / trimestre)
            </span>
          </label>
          <input type="number" id="capacity" min="100" step="50" value="1000" />
          <div class="muted">Augmenter la capacité coûte cher, mais évite d’être limité.</div>
        </div>

        <div>
          <label>
            <span class="has-tip" data-tip="Qualité du process industriel (0–100). Plus haut = moins de défauts/SAV.">
              Qualité process (0–100)
            </span>
          </label>
          <input type="range" id="qprocess" min="0" max="100" value="45" />
          <div class="muted">Plus haut = SAV ↓</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>
            <span class="has-tip" data-tip="Stock de composants. Une unité produite consomme 1 stock.">
              Stock composants (unités)
            </span>
          </label>
          <input type="number" id="stock" min="0" step="100" value="1200" />
        </div>

        <div>
          <label>
            <span class="has-tip" data-tip="Achat de composants ce trimestre (coûte de la trésorerie).">
              Achat composants (ce trimestre)
            </span>
          </label>
          <input type="number" id="buy" min="0" step="100" value="1000" />
        </div>
      </div>
    </div>

    <div class="info-block">
      <div class="badge">
        <span class="has-tip" data-tip="Taux estimé de défauts/SAV. Dépend surtout du process et de la maturité OS.">
          SAV attendu
        </span> :
        <b id="defect-preview">0.0%</b>
      </div>
      <div class="muted" style="margin-top:8px;">
        Le SAV coûte de l’argent et peut impacter ta Réputation.
      </div>
    </div>
  </section>

  <section class="card" id="screen-market" style="display:none">
    <h3>Marché</h3>

    <div class="interactive-block">
      <div class="row">
        <div>
          <label>
            <span class="has-tip" data-tip="Budget marketing ce trimestre. Plus efficace si ta Réputation est déjà correcte.">
              Marketing (USD)
            </span>
          </label>
          <input type="number" id="mkt" min="0" step="10000" value="20000" />
          <div class="muted">Plus haut = visibilité ↑</div>
        </div>

        <div>
          <label>
            <span class="has-tip" data-tip="Canal de vente. Opérateurs = volume ↑ mais marge ↓. B2B = plus stable mais volumes plus faibles.">
              Distribution
            </span>
          </label>
          <select id="channel">
            <option value="b2b">B2B (stable, volumes bas)</option>
            <option value="retail" selected>Retail (standard)</option>
            <option value="carrier">Opérateurs (volume, marge plus faible)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="info-block">
      <pre id="market-readout">…</pre>
    </div>
  </section>

  <section class="card" id="screen-report" style="display:none">
    <h3>Bilan du trimestre</h3>

    <div class="info-block">
      <pre id="report">Lance un trimestre pour voir le bilan.</pre>
    </div>

    <div class="actions">
      <button class="primary" id="btn-next">Lancer le trimestre</button>
    </div>
  </section>
</main>

<nav>
  <button data-screen="product" class="active">Produit</button>
  <button data-screen="production">Prod</button>
  <button data-screen="market">Marché</button>
  <button data-screen="report">Bilan</button>
</nav>

<!-- Cache iOS : incrémente si besoin -->
<script type="module" src="./app.js?v=6"></script>

<!-- PATCH #4 (partie visuelle) : met à jour la mini-bar en fonction de la valeur -->
<script>
  // Petite amélioration pure UI : si app.js met à jour #dev-attract, on synchronise la barre.
  // (Sans toucher à app.js)
  const syncDevBar = () => {
    const vEl = document.getElementById("dev-attract");
    const bar = document.getElementById("dev-bar");
    if (!vEl || !bar) return;
    const txt = (vEl.textContent || "0").trim();
    const v = Math.max(0, Math.min(100, parseInt(txt, 10) || 0));
    bar.style.width = v + "%";
  };

  // boucle légère
  setInterval(syncDevBar, 400);
</script>

</body>
</html>
